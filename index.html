<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinancePro | HÃ­brido</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .mobile-nav { display: none; }
        @media (max-width: 768px) {
            .mobile-nav { display: flex; }
            .desktop-header { padding: 10px 20px; }
            body { padding-bottom: 80px; }
            .hide-mobile { display: none; }
        }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

<div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 p-4">
    <div class="bg-white p-8 rounded-3xl w-full max-w-md shadow-2xl">
        <h2 class="text-2xl font-bold text-center text-blue-600 mb-6">FinancePro</h2>
        <div class="space-y-4">
            <input type="email" id="email" placeholder="Seu e-mail" class="w-full p-4 bg-slate-100 rounded-xl outline-none">
            <input type="password" id="senha" placeholder="Sua senha" class="w-full p-4 bg-slate-100 rounded-xl outline-none">
            <button onclick="login()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg">Entrar / Criar Conta</button>
        </div>
    </div>
</div>

<div id="main-app" class="hidden">
    <header class="bg-white border-b sticky top-0 z-40 px-4 py-3 desktop-header">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <span class="text-xl font-bold text-blue-600">FP</span>
                <select id="filtroMesAno" onchange="atualizarDados()" class="bg-slate-100 p-2 rounded-lg font-bold text-sm outline-none">
                    </select>
            </div>
            <button onclick="logout()" class="text-red-500 font-bold text-xs uppercase">Sair</button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 md:p-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
            <div class="bg-white p-4 rounded-2xl shadow-sm border-b-4 border-green-500">
                <p class="text-[10px] font-bold text-slate-400 uppercase">Rendas</p>
                <p class="text-lg font-bold">R$ <span id="resumoRenda">0,00</span></p>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm border-b-4 border-red-500">
                <p class="text-[10px] font-bold text-slate-400 uppercase">Gastos</p>
                <p class="text-lg font-bold">R$ <span id="resumoGastos">0,00</span></p>
            </div>
            <div class="bg-blue-600 p-4 rounded-2xl shadow-lg text-white col-span-2">
                <p class="text-[10px] font-bold opacity-80 uppercase">Saldo DisponÃ­vel (Renda - Pago)</p>
                <p class="text-2xl font-bold">R$ <span id="resumoSaldo">0,00</span></p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div id="aba-add" class="tab-content lg:block lg:col-span-1">
                <div class="bg-white p-6 rounded-3xl shadow-sm sticky top-24">
                    <h3 class="font-bold mb-4">Novo LanÃ§amento</h3>
                    <div class="space-y-4">
                        <select id="tipo" class="w-full p-3 bg-slate-50 rounded-xl outline-none border">
                            <option value="despesa">Despesa</option>
                            <option value="renda">Renda</option>
                        </select>
                        <input type="text" id="descricao" placeholder="O que Ã©?" class="w-full p-3 bg-slate-50 rounded-xl outline-none border">
                        <div class="flex gap-2">
                            <input type="number" id="valor" placeholder="Valor" class="flex-1 p-3 bg-slate-50 rounded-xl outline-none border">
                            <input type="number" id="parcelas" value="1" class="w-20 p-3 bg-slate-50 rounded-xl outline-none border">
                        </div>
                        <input type="date" id="data" class="w-full p-3 bg-slate-50 rounded-xl outline-none border">
                        <button onclick="salvar()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl">Salvar</button>
                    </div>
                </div>
            </div>

            <div id="aba-list" class="tab-content active lg:block lg:col-span-2">
                <div class="bg-white rounded-3xl shadow-sm overflow-hidden">
                    <div class="p-4 bg-slate-50 border-b flex justify-between items-center">
                        <h3 class="font-bold text-sm">Movimentos do MÃªs</h3>
                        <span id="contagem" class="text-[10px] bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">0 itens</span>
                    </div>
                    <div id="listaLancamentos" class="divide-y">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <nav class="mobile-nav fixed bottom-0 left-0 right-0 bg-white border-t p-3 justify-around z-50 shadow-2xl">
        <button onclick="alternarAba('list')" class="flex flex-col items-center gap-1">
            <span class="text-xl">ðŸ“„</span>
            <span class="text-[10px] font-bold">Extrato</span>
        </button>
        <button onclick="alternarAba('add')" class="flex flex-col items-center gap-1">
            <span class="text-xl text-blue-600">âž•</span>
            <span class="text-[10px] font-bold">Novo</span>
        </button>
        <button onclick="gerarPDF()" class="flex flex-col items-center gap-1">
            <span class="text-xl">ðŸ“¥</span>
            <span class="text-[10px] font-bold">PDF</span>
        </button>
    </nav>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyClaCzlMv9lYkZglYHH_R6XlggA5Ifgaw8",
  authDomain: "contas-8ecfa.firebaseapp.com",
  projectId: "contas-8ecfa",
  storageBucket: "contas-8ecfa.firebasestorage.app",
  messagingSenderId: "477279202548",
  appId: "1:477279202548:web:00b0241177b66520b2c2a1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
let currentUser = null;

// LÃ³gica de AutenticaÃ§Ã£o para Mobile
async function login() {
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;
    try {
        await auth.signInWithEmailAndPassword(email, senha);
    } catch(e) {
        try {
            await auth.createUserWithEmailAndPassword(email, senha);
        } catch(err) { alert("Erro: " + err.message); }
    }
}

auth.onAuthStateChanged(user => {
    if(user) {
        currentUser = user;
        document.getElementById("auth-screen").classList.add("hidden");
        document.getElementById("main-app").classList.remove("hidden");
        init();
    } else {
        document.getElementById("auth-screen").classList.remove("hidden");
        document.getElementById("main-app").classList.add("hidden");
    }
});

function init() {
    const sel = document.getElementById("filtroMesAno");
    if(sel.options.length > 0) return;
    const meses = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
    const hoje = new Date();
    for(let i = -6; i <= 6; i++) {
        let d = new Date(hoje.getFullYear(), hoje.getMonth() + i, 1);
        let val = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        let txt = `${meses[d.getMonth()]} / ${d.getFullYear()}`;
        sel.add(new Option(txt, val, i===0, i===0));
    }
    atualizarDados();
}

async function salvar() {
    const tipo = document.getElementById("tipo").value;
    const desc = document.getElementById("descricao").value;
    const valor = parseFloat(document.getElementById("valor").value);
    const parc = parseInt(document.getElementById("parcelas").value);
    const data = document.getElementById("data").value;

    if(!desc || !valor || !data) return alert("Preencha tudo!");

    const col = tipo === 'despesa' ? 'contas' : 'rendas';
    const dataBase = new Date(data + "T12:00:00");

    for(let i=0; i<parc; i++) {
        let d = new Date(dataBase);
        d.setMonth(d.getMonth() + i);
        await db.collection(col).add({
            descricao: parc > 1 ? `${desc} ${i+1}/${parc}` : desc,
            valor: tipo === 'despesa' ? (valor/parc) : valor,
            data: d.toISOString().split('T')[0],
            pago: false,
            userId: currentUser.uid
        });
    }
    alert("Salvo!");
    alternarAba('list');
    atualizarDados();
}

async function atualizarDados() {
    if(!currentUser) return;
    const mesAno = document.getElementById("filtroMesAno").value;
    const resRenda = await db.collection("rendas").where("userId","==",currentUser.uid).get();
    const resContas = await db.collection("contas").where("userId","==",currentUser.uid).get();

    let totalRenda = 0, totalGastos = 0, totalPago = 0;
    const lista = document.getElementById("listaLancamentos");
    lista.innerHTML = "";

    resRenda.docs.forEach(doc => {
        if(doc.data().data.startsWith(mesAno)) totalRenda += doc.data().valor;
    });

    const contas = resContas.docs
        .map(d => ({...d.data(), id: d.id}))
        .filter(d => d.data.startsWith(mesAno));

    contas.forEach(c => {
        totalGastos += c.valor;
        if(c.pago) totalPago += c.valor;

        const div = document.createElement("div");
        div.className = "p-4 flex justify-between items-center hover:bg-slate-50";
        div.innerHTML = `
            <div onclick="togglePago('${c.id}', ${c.pago})" class="flex-1">
                <p class="font-bold text-sm ${c.pago ? 'text-slate-400 line-through' : 'text-slate-700'}">${c.descricao}</p>
                <p class="text-[10px] text-slate-400">${c.data.split('-').reverse().join('/')}</p>
            </div>
            <div class="text-right">
                <p class="font-bold text-sm">R$ ${c.valor.toFixed(2)}</p>
                <button onclick="excluir('${c.id}')" class="text-[10px] text-red-400">Remover</button>
            </div>
        `;
        lista.appendChild(div);
    });

    document.getElementById("resumoRenda").innerText = totalRenda.toFixed(2);
    document.getElementById("resumoGastos").innerText = totalGastos.toFixed(2);
    document.getElementById("resumoSaldo").innerText = (totalRenda - totalPago).toFixed(2);
    document.getElementById("contagem").innerText = `${contas.length} lanÃ§amentos`;
}

async function togglePago(id, status) {
    await db.collection("contas").doc(id).update({pago: !status});
    atualizarDados();
}

async function excluir(id) {
    if(confirm("Excluir?")) {
        await db.collection("contas").doc(id).delete();
        atualizarDados();
    }
}

function alternarAba(aba) {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.getElementById(`aba-${aba}`).classList.add('active');
}

function logout() { auth.signOut(); }
</script>
</body>
</html>
