<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Pro | Gest√£o Inteligente</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        .glass-card { background: white; border-radius: 1.5rem; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .input-field { @apply w-full p-3 rounded-xl border border-slate-200 bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all; }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all active:scale-95 shadow-lg shadow-blue-200; }
        
        /* Ajustes Mobile */
        @media (max-width: 768px) {
            .mobile-grid { grid-template-columns: 1fr; }
            .desktop-only { display: none; }
            body { padding-bottom: 90px; }
        }
    </style>
</head>
<body>

<div id="auth-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-50 p-4">
    <div class="glass-card w-full max-w-md p-8 shadow-2xl">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-600 tracking-tight">Finance<span class="text-slate-800">Pro</span></h1>
            <p class="text-slate-500 text-sm mt-2">Acesse sua conta para gerenciar seus gastos</p>
        </div>
        <div class="space-y-4">
            <input type="email" id="email" placeholder="Seu e-mail" class="input-field">
            <input type="password" id="senha" placeholder="Sua senha" class="input-field">
            <button onclick="login()" class="btn-primary w-full">Entrar ou Criar Conta</button>
        </div>
        <p class="mt-8 text-center text-[10px] text-slate-400 uppercase tracking-widest font-bold">Nay Cordeiro ‚Ä¢ Gest√£o Financeira</p>
    </div>
</div>

<div id="app" class="hidden min-h-screen">
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 p-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <h2 class="font-bold text-xl text-blue-600">FinancePro</h2>
                <div class="bg-slate-100 rounded-lg px-2 py-1 flex items-center">
                    <select id="filtroMesAno" onchange="atualizarDados()" class="bg-transparent text-sm font-bold text-slate-600 outline-none cursor-pointer">
                        </select>
                </div>
            </div>
            <button onclick="logout()" class="text-sm font-bold text-red-500 bg-red-50 px-4 py-2 rounded-lg">Sair</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-8 space-y-8">
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="glass-card p-6 border-l-4 border-green-500">
                <p class="text-slate-400 text-[10px] uppercase font-bold mb-1">Minha Renda</p>
                <h3 class="text-2xl font-bold text-slate-800">R$ <span id="resumoRenda">0,00</span></h3>
            </div>
            <div class="glass-card p-6 border-l-4 border-red-500">
                <p class="text-slate-400 text-[10px] uppercase font-bold mb-1">Total de Gastos</p>
                <h3 class="text-2xl font-bold text-slate-800">R$ <span id="resumoGastos">0,00</span></h3>
            </div>
            <div class="glass-card p-6 border-l-4 border-blue-500">
                <p class="text-slate-400 text-[10px] uppercase font-bold mb-1">Total Pago</p>
                <h3 class="text-2xl font-bold text-slate-800">R$ <span id="resumoPago">0,00</span></h3>
            </div>
            <div class="bg-blue-600 p-6 rounded-[1.5rem] shadow-xl shadow-blue-200 text-white">
                <p class="text-blue-100 text-[10px] uppercase font-bold mb-1">Saldo Livre</p>
                <h3 class="text-2xl font-bold">R$ <span id="resumoSaldo">0,00</span></h3>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1">
                <div class="glass-card p-6 sticky top-28">
                    <h3 class="font-bold text-lg mb-6 flex items-center gap-2">
                        <span class="w-2 h-6 bg-blue-600 rounded-full"></span> 
                        Novo Registro
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 ml-1">TIPO</label>
                            <select id="tipo" class="input-field">
                                <option value="despesa">Despesa (Sa√≠da)</option>
                                <option value="renda">Renda (Entrada)</option>
                            </select>
                        </div>
                        <input type="text" id="descricao" placeholder="Descri√ß√£o (Ex: Supermercado)" class="input-field">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="valor" placeholder="Valor" class="input-field">
                            <input type="number" id="parcelas" placeholder="Parc." value="1" class="input-field">
                        </div>
                        <input type="date" id="data" class="input-field">
                        <button onclick="salvar()" class="btn-primary w-full mt-2">Salvar no M√™s</button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="font-bold text-lg">Extrato do Per√≠odo</h3>
                    <span id="contadorItens" class="text-xs bg-slate-200 px-3 py-1 rounded-full font-medium text-slate-600">0 lan√ßamentos</span>
                </div>

                <div class="glass-card overflow-hidden desktop-only">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-slate-400 text-[10px] font-bold uppercase">
                            <tr>
                                <th class="p-4">Descri√ß√£o</th>
                                <th class="p-4">Vencimento</th>
                                <th class="p-4 text-right">Valor</th>
                                <th class="p-4 text-center">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaDados" class="divide-y divide-slate-100">
                            </tbody>
                    </table>
                </div>

                <div id="listaMobile" class="space-y-3 md:hidden">
                    </div>

                <button onclick="gerarPDF()" class="w-full py-4 bg-white border-2 border-dashed border-slate-300 rounded-2xl text-slate-500 font-bold hover:bg-slate-50 transition">
                    üì• Baixar Relat√≥rio do M√™s (PDF)
                </button>
            </div>
        </div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-200 p-4 flex justify-around z-50">
        <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="flex flex-col items-center text-blue-600">
            <span class="text-xl">üè†</span>
            <span class="text-[10px] font-bold">In√≠cio</span>
        </button>
        <button onclick="document.getElementById('descricao').focus()" class="flex flex-col items-center text-slate-400">
            <span class="text-xl">‚ûï</span>
            <span class="text-[10px] font-bold">Adicionar</span>
        </button>
        <button onclick="logout()" class="flex flex-col items-center text-red-400">
            <span class="text-xl">üö™</span>
            <span class="text-[10px] font-bold">Sair</span>
        </button>
    </nav>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyClaCzlMv9lYkZglYHH_R6XlggA5Ifgaw8",
  authDomain: "contas-8ecfa.firebaseapp.com",
  projectId: "contas-8ecfa",
  storageBucket: "contas-8ecfa.firebasestorage.app",
  messagingSenderId: "477279202548",
  appId: "1:477279202548:web:00b0241177b66520b2c2a1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
let currentUser = null;

// AUTENTICA√á√ÉO
async function login() {
    const e = document.getElementById("email").value;
    const s = document.getElementById("senha").value;
    if(!e || !s) return alert("Preencha os campos!");
    try {
        await auth.signInWithEmailAndPassword(e, s);
    } catch(err) {
        try { await auth.createUserWithEmailAndPassword(e, s); } 
        catch(e2) { alert("Erro: " + e2.message); }
    }
}

auth.onAuthStateChanged(user => {
    if(user) {
        currentUser = user;
        document.getElementById("auth-screen").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        init();
    } else {
        document.getElementById("auth-screen").classList.remove("hidden");
        document.getElementById("app").classList.add("hidden");
    }
});

// INICIALIZA√á√ÉO
function init() {
    const sel = document.getElementById("filtroMesAno");
    if(sel.options.length > 0) return;
    const meses = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
    const hoje = new Date();
    for(let i = -12; i <= 12; i++) {
        let d = new Date(hoje.getFullYear(), hoje.getMonth() + i, 1);
        let val = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        let txt = `${meses[d.getMonth()]} ${d.getFullYear()}`;
        sel.add(new Option(txt, val, i===0, i===0));
    }
    atualizarDados();
}

async function salvar() {
    const tipo = document.getElementById("tipo").value;
    const desc = document.getElementById("descricao").value;
    const valor = parseFloat(document.getElementById("valor").value);
    const parc = parseInt(document.getElementById("parcelas").value);
    const data = document.getElementById("data").value;

    if(!desc || !valor || !data) return alert("Preencha tudo corretamente!");

    const colecao = tipo === 'despesa' ? 'contas' : 'rendas';
    const dataBase = new Date(data + "T12:00:00");

    for(let i=0; i<parc; i++) {
        let d = new Date(dataBase);
        d.setMonth(d.getMonth() + i);
        await db.collection(colecao).add({
            descricao: parc > 1 ? `${desc} (${i+1}/${parc})` : desc,
            valor: tipo === 'despesa' ? (valor/parc) : valor,
            data: d.toISOString().split('T')[0],
            pago: false,
            userId: currentUser.uid
        });
    }
    
    document.getElementById("descricao").value = "";
    document.getElementById("valor").value = "";
    atualizarDados();
}

async function atualizarDados() {
    if(!currentUser) return;
    const mesAno = document.getElementById("filtroMesAno").value;
    
    const snapContas = await db.collection("contas").where("userId","==",currentUser.uid).get();
    const snapRendas = await db.collection("rendas").where("userId","==",currentUser.uid).get();

    let tRenda = 0, tGastos = 0, tPago = 0;
    const tabela = document.getElementById("tabelaDados");
    const listaMob = document.getElementById("listaMobile");
    tabela.innerHTML = ""; listaMob.innerHTML = "";

    // Calcular Renda
    snapRendas.docs.forEach(doc => {
        if(doc.data().data.startsWith(mesAno)) tRenda += doc.data().valor;
    });

    // Listar Despesas
    const contas = snapContas.docs
        .map(d => ({...d.data(), id: d.id}))
        .filter(d => d.data.startsWith(mesAno))
        .sort((a,b) => new Date(a.data) - new Date(b.data));

    contas.forEach(c => {
        tGastos += c.valor;
        if(c.pago) tPago += c.valor;

        // Render Desktop
        const tr = document.createElement("tr");
        tr.className = "hover:bg-slate-50 transition";
        tr.innerHTML = `
            <td class="p-4 font-semibold text-slate-700">${c.descricao}</td>
            <td class="p-4 text-slate-400 text-sm">${c.data.split('-').reverse().join('/')}</td>
            <td class="p-4 text-right font-bold text-slate-700">R$ ${c.valor.toFixed(2)}</td>
            <td class="p-4 text-center space-x-2">
                <button onclick="togglePago('${c.id}', ${c.pago})" class="px-3 py-1 rounded-lg text-[10px] font-bold uppercase ${c.pago ? 'bg-green-100 text-green-600' : 'bg-amber-100 text-amber-600'}">
                    ${c.pago ? 'Pago' : 'Pagar'}
                </button>
                <button onclick="excluir('${c.id}')" class="text-red-300 hover:text-red-500 text-sm">üóëÔ∏è</button>
            </td>
        `;
        tabela.appendChild(tr);

        // Render Mobile
        const card = document.createElement("div");
        card.className = `glass-card p-4 border-l-4 ${c.pago ? 'border-green-500' : 'border-amber-500'}`;
        card.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <div>
                    <p class="font-bold text-slate-700">${c.descricao}</p>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">${c.data.split('-').reverse().join('/')}</p>
                </div>
                <p class="font-bold text-slate-800">R$ ${c.valor.toFixed(2)}</p>
            </div>
            <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                <button onclick="togglePago('${c.id}', ${c.pago})" class="text-xs font-bold uppercase ${c.pago ? 'text-green-600' : 'text-amber-500'}">
                    ${c.pago ? '‚úì Pago' : '‚óØ Marcar Pago'}
                </button>
                <button onclick="excluir('${c.id}')" class="text-xs text-red-300">Excluir</button>
            </div>
        `;
        listaMob.appendChild(card);
    });

    document.getElementById("resumoRenda").innerText = tRenda.toLocaleString('pt-BR',{minimumFractionDigits:2});
    document.getElementById("resumoGastos").innerText = tGastos.toLocaleString('pt-BR',{minimumFractionDigits:2});
    document.getElementById("resumoPago").innerText = tPago.toLocaleString('pt-BR',{minimumFractionDigits:2});
    document.getElementById("resumoSaldo").innerText = (tRenda - tPago).toLocaleString('pt-BR',{minimumFractionDigits:2});
    document.getElementById("contadorItens").innerText = `${contas.length} lan√ßamentos`;
}

async function togglePago(id, status) {
    await db.collection("contas").doc(id).update({pago: !status});
    atualizarDados();
}

async function excluir(id) {
    if(confirm("Deseja apagar?")) {
        await db.collection("contas").doc(id).delete();
        atualizarDados();
    }
}

function logout() { auth.signOut(); }
function gerarPDF() { window.print(); } // Simplificado para fins de layout
</script>
</body>
</html>
